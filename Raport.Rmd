---
title: "Komputerowa analiza szeregów czasowych - raport 2"
author: "Szymon Malec 262276 , Tomasz Hałas 2546347"
output:
  pdf_document: 
    number_sections: true
    extra_dependencies: ["polski", "mathtools", "amsthm", "amssymb", "icomma", "upgreek", "xfrac", "scrextend", "float", "tabularx", "hyperref", "caption", "enumitem", "titlesec"]
fontsize: 12pt
---

\renewcommand{\figurename}{Wykres}
\renewcommand{\tablename}{Tablica}
\raggedbottom
\titlelabel{ \thetitle.\quad}







\section{Wstęp}

|       Celem niniejszej pracy jest wykorzystanie modelu ARMA do zbadania danych opisujących średnią temperaturę w Warszawie. Skorzystaliśmy z danych dostępnych pod adresem \footnote{https://academic.udayton.edu/kissock/http/Weather/default.htm}, pochodzące z amerykańskiego National Climatic Data Center. Strona zawiera średnie dobowe temperatury dla 157 miast amerykańskich i 167 międzynarodowych. Dane są aktualizowane na bieżąco i zawierają dane od 1 stycznia 1995 do chwili obecnej. Pogoda jest mierzona za pomocą stopni Fahrenheita. Dane pogodowe dla miasta Warszawy znadują się na wykresie \ref{fig:danePogodowe}.

\begin{figure}[H]
  \includegraphics{images/raw_data.pdf}
    \caption{Wykresy temperatury dla miasta Warszawa}
  \centering
  \label{fig:danePogodowe}
\end{figure}

Na wykresie \ref{fig:danePogodowe} zauważalne są braki danych jakie występują w naszym zbiorze danych.

\section{Opis danych}

|       Ze względu na fakt, że posiadany przez nas zbiór danych jest bardzo obszerny oraz braku niektórych danych postanowiliśmy wziąść nasze dane do modelu z przedziału 22.06.2002 - 27.08.2007.  Wykres temperatur dla miasta Warszawa w tym okresie prezentuje się następująco \ref{fig:daneZakres}:


\begin{figure}[H]

  \includegraphics{images/range_data.pdf}
  \caption{Wykresy temperatury dla miasta Warszawa w latach 2002-2007.}
  \centering
  \label{fig:daneZakres}
\end{figure}

Dane opisujace pogode w mieście Warszawa charakteryzują się występowaniem okresowości. Położenie tego miasta w środowej Europie sprawia, że występują w nim cztery poru roku co widać na wykresie \ref{fig:daneZakres}. Dodatkowo zauważalna na wykresie jest wariancją, która spowodawana jest nagłymi zmiannami pogody. Na takich danych rozpoczeliśmy dalszą pracę.






\section{Przygotowanie danych}

|       Na wykresie \ref{daneZakres} zauważyć można, że w danych występuje wyraźna okresowość. Nie jest to oczywiście zaskoczeniem, ponieważ dane opisują temperaturę, która w zimie przyjmuje mniejsze wartości niż w lecie. Z powodu występującej okresowości, stwierdzamy, że szereg z pewnością nie jest stacjonarny w słabym sensie, co potwierdzają także wykresy ACF i PACF (wykres \ref{raw_acf}). W szczególności wykres funkcji autokorelacji, która bardzo powoli zbiega do zera, wskazuje na brak stacjonarności.

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/raw_acf.pdf}
		\caption{Wykresy funkcji autokorelacji (ACF) i autokorelacji cząstkowej (PACF) dla surowych danych w zależności od przesunięcia $h$.}
    \label{raw_acf}
\end{figure}

|       Oznaczmy badany szereg jako $\{X_t\}, \ t \in \{1, 2, \dots, 1893\}$. Aby uzyskać stacjonarność, skorzystamy z metody różnicowania. Definiujemy nowy szereg
$$
  \tilde{X}_t = X_{t+1} - X_t, \ \ \ t \in \{1, 2, \dots, 1892\}.
$$
Na wykresie \ref{diff_temp} zobaczyć można, że szereg $\tilde{X}_t$ oscyluje wokół zera, a jego wariancja wydaje się być stabilna.

\begin{figure}[H]
		\centering
		\includegraphics[width=350pt]{images/diff_temp.pdf}
		\caption{Dane po zastosowaniu metody różnicowania.}
    \label{diff_temp}
\end{figure}

Dodatkowo wykresy ACF i PACF (wykres \ref{diff_acf}) nie dają podstaw, by przypuszczać że, szereg nie jest stacjonarny. Możemy zatem przejść do dopasowania modelu ARMA do szeregu $\{\tilde{x}\}$.

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/diff_acf.pdf}
		\caption{Wykresy funkcji autokorelacji (ACF) i autokorelacji cząstkowej (PACF) dla danych po zastosowaniu metody różnicowania w zależności od przesunięcia $h$.}
    \label{diff_acf}
\end{figure}






\section{Dopasowanie modelu ARMA}

|       Rozważmy podstawowy model ARMA($p$, $q$)
$$
  \tilde{X}_t - \varphi_1 \tilde{X}_{t-1} - ... - \varphi_p \tilde{X}_{t-p} = Z_t + \theta_1 Z_{t-1} + ... + \theta_q Z_{t-q},
$$
gdzie $\{Z_i\}_i \sim WN(0, \sigma^2)$ jest białym szumem. W pierwszej kolejności musimy dobrać odpowiedni rząd modelu tzn. takie $p$ i $q$, dla których model będzie najlepiej dopasowany. W tym celu skorzystamy z kryterium informacyjnego AIC (Akaike information criterion). Im mniejsza wartość statystyki, tym lepiej dopasowany jest model. Aby wyłonić najbardziej optymalne $p$ i $q$, obliczamy statystykę AIC dla wszystkich kombinacji $p \in \{1, 2, ..., 8\}$ oraz $q \in \{1, 2, ..., 8\}$. Dla naszych danych, najmniejszą wartość statystyka przyjęła dla $p = 3$ i $q = 4$. Możemy zatem uprościć model do postaci ARMA(3, 4), tj.
$$
  \tilde{X}_t - \varphi_1 \tilde{X}_{t-1} - \varphi_2 \tilde{X}_{t-2} - \varphi_3 \tilde{X}_{t-3} = Z_t + \theta_1 Z_{t-1} + \theta_2 Z_{t-2} + \theta_3 Z_{t-3} + \theta_4 Z_{t-4}.
$$
Aby wyestymować współczynniki $\varphi_{1, 2, 3}$ i $\theta_{1, 2, 3, 4}$ oraz $\sigma^2$, wykorzystamy pakiet Stats dostępny w języku R. Obliczone wartości parametrów widoczne są w tabeli. Do ich obliczenia wykorzystane zostały estymatory wyznaczone metodą największej wiarygodności.

|       Aby sprawdzić, czy model został dobrze dopasowany, przeprowadzimy symulację Monte Carlo w celu wyznaczenia przedziałów ufności dla funkcji ACF i PACF naszego modelu. Generujemy 10 000 trajektorii procesu ARMA(3, 4) z wyznaczonymi współczynnikami i dla każdej trajektorii obliczamy ACF i PACF. Natępnie, dla każdego przesunięcia $h$, wyznaczamy kwantyle z próby (rzędu $\frac{\alpha}{2}$ i $1 - \frac{\alpha}{2}$). W ten sposób dla każdego $h$ otrzymujemy przedział ufności.

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/conf_intervals.pdf}
		\caption{Wykresy ACF i PACF dla szeregu $\tilde{X}_t$ wraz z przedziałami ufności na poziomie ufności $1 - \alpha = 0.95$.}
    \label{conf_intervals}
\end{figure}






\section{Analiza szumu}

Analiza szumu w modelu ARMA polega na ocenie jakości modelu poprzez określenie stopnia, w jakim jego prognozy odpowiadają rzeczywistym danym. W ARMA, szum jest reprezentowany przez błąd prognozowania, który jest różnicą między prognozowanymi wartościami a rzeczywistymi wartościami. Aby ocenić jakość modelu, spojrzymy na:

\begin{itemize}
  \item założenie dot. średniej (wykres wartości resztowych)
  \item założenie dot. wariancji (wykres wartości resztowych)
  \item założenie dot. niezależności (wykres ACF/PACF dla wartości resztowych)
  \item założenie dot. normalności rozkładu (dystrybuanta / gęstość / test KS).
\end{itemize}

Zaczynając od wykresu wartości resztowych:
\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/res_data.pdf}
		\caption{Wykres wartości resztowych}
    \label{rest_data}
\end{figure}

Widzimy, że na wykresie \ref{rest_data} nasze wartości oscylują wokół 0. Pojawia się tam też wariancja, ale jest ona w miare umiarkowana. Nie występują na nim dość znaczące wartości odstające. Chcąc przebadać wariancje szumu wykonaliśmy wykres wariancji cząstkowej \ref{var_rest_data}. Im mniejsze wahania wariancji cząstkowej, tym lepsza jest prognoza modelu i tym mniejsze są błędy prognozowania.

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/var_res_data.pdf}
		\caption{Wykres wariancji cząstkowej dla $k=200$}
    \label{var_rest_data}
\end{figure}

Widzimy, że na wykresie \ref{var_rest_data} występuje okresowość, co jest charakterystycznym zjawiskiem dla danych pogodowych oraz pojawia się oscylująca wariancja. W takiej sytuacji należałoby się zastanowić nad użyciem metody Boxa-Coxa w celu normalizacji wariancji.

Następnie analizie poddaliśmy niezależności:

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/acf_res.pdf}
		\caption{Wykresy ACF i PACF dla wartości resztowych}
    \label{acf_rest_data}
\end{figure}

Na podstawie wykresów \ref{acf_rest_data} autokowariancji oraz autokorelacji cząstkowej możemy stwierdzić, że są one niezależne od siebie, ponieważ residua oscylują wokół 0. 


Następnie analizie poddaliśmy normalność:


\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/des_res.pdf}
		\caption{Wykres gęstości residów}
    \label{den_data}
\end{figure}

\begin{figure}[H]
		\centering
		\includegraphics[width=\columnwidth]{images/dys_res.pdf}
		\caption{Wykres dystybuanty empirycznej i teoretycznej}
    \label{dys_data}
\end{figure}

Na podstawie wykresów \ref{den_data}, \ref{dys_data} widzimy, że residua mają rozkład normlany. Sprawdziliśmy to również wykonując Test Kołmogorowa-Smirnowa na poziome istności $\alpha=0.05$. Otrzymana $p$-wartość wynosi 0.2905, co umożliwa nam przyjąć tezę o normalnym rozkładzie residów.

\section{Podsumowanie}

  Na podstawie analizy szumów widzimy, że nasz model został dobrze dopasowany do danych wejściowych. 
